<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026æ–°æ˜¥å…¨è‡ªå®šä¹‰è½¦ç¥¨-ç¯ç¬¼ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@700&family=Roboto+Mono:wght@500;700&display=swap');

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px 15px;
            color: #eee;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            /* èƒŒæ™¯ï¼šæ·±è“å¤œç©º */
            background-color: #1a1a2e; 
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(255, 215, 0, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(200, 50, 50, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 50% 0%, #2b3a55 0%, #1a1a2e 100%);
            background-attachment: fixed;
        }

        h2 {
            margin: 0 0 20px;
            color: #ffda77;
            font-size: 1.5rem;
            text-align: center;
            text-shadow: 0 2px 10px rgba(255, 218, 119, 0.3);
            letter-spacing: 1px;
        }

        #scale-container {
            width: 100%;
            max-width: 640px;
            margin: 0 auto 20px;
            position: relative;
            height: 400px; 
            overflow: hidden;
            filter: drop-shadow(0 15px 30px rgba(0,0,0,0.5));
        }

        /* --- è½¦ç¥¨æœ¬ä½“ --- */
        .ticket {
            width: 640px;
            height: 400px;
            position: absolute;
            top: 0; left: 0;
            transform-origin: top left;
            border-radius: 12px;
            background-color: #e4f2ff;
            /* æŸ”å’Œçš„åº•çº¹ï¼Œæ— å¼ºå…‰æ™• */
            background-image: 
                radial-gradient(circle at 40% 40%, rgba(255,255,255,0.4) 0%, transparent 60%),
                repeating-linear-gradient(45deg, transparent, transparent 3px, rgba(0, 80, 200, 0.03) 3px, rgba(0, 80, 200, 0.03) 6px);
            color: #333;
            padding: 25px 30px;
            box-sizing: border-box;
            user-select: none;
            border: 1px solid #cce0ff;
            overflow: hidden;
        }

        /* --- ç¯ç¬¼æ°´å°æ ·å¼ --- */
        .watermark-lantern {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 280px; /* å¤§å°é€‚ä¸­ */
            height: auto;
            /* ä½¿ç”¨ææ·¡çš„çº¢è‰²ï¼Œæ¨¡æ‹Ÿé€å…‰æ°´å° */
            color: rgba(220, 20, 20, 0.06); 
            pointer-events: none;
            z-index: 0;
        }

        /* ç¥¨é¢å…ƒç´  */
        .serial-number { position: absolute; top: 20px; left: 25px; font-family: "Roboto Mono", monospace; color: #d80000; font-size: 15px; font-weight: bold; z-index: 2; }
        .check-gate { position: absolute; top: 20px; right: 25px; font-size: 14px; font-weight: bold; z-index: 2; }
        .check-gate span { font-size: 20px; }
        .station-row { margin-top: 40px; display: flex; justify-content: space-between; align-items: baseline; height: 60px; position: relative; z-index: 2; }
        .station { font-size: 44px; font-weight: 900; font-family: "SimHei", sans-serif; color: #000; letter-spacing: -1px; white-space: nowrap; }
        .train-center { text-align: center; flex: 1; display: flex; flex-direction: column; align-items: center; }
        .train-code { font-family: "Roboto Mono", monospace; font-size: 24px; font-weight: bold; }
        .arrow-icon { font-size: 16px; color: #666; transform: scaleX(2); margin-top: -2px; }
        .info-row { margin-top: 25px; display: flex; justify-content: space-between; align-items: flex-end; position: relative; z-index: 2; }
        .date-section { font-family: "Roboto Mono", sans-serif; font-size: 18px; font-weight: 600; line-height: 1.5; }
        .price-section { font-size: 18px; font-weight: bold; }
        .price-section span { font-size: 28px; }
        .seat-row { margin-top: 25px; font-size: 17px; font-weight: 600; display: flex; gap: 15px; align-items: baseline; position: relative; z-index: 2; }
        .seat-class-label { font-size: 16px; font-weight: normal; margin-left: 5px; }
        .passenger-row { margin-top: 15px; display: flex; align-items: baseline; position: relative; z-index: 2; }
        .passenger-name { font-size: 18px; font-weight: bold; margin-right: 15px; }
        .passenger-id { font-size: 14px; font-family: "Roboto Mono", monospace; color: #555; }
        .bottom-bar { position: absolute; bottom: 0; left: 0; width: 100%; height: 36px; background-color: #fff; border-top: 1px dashed #ccc; display: flex; align-items: center; padding-left: 25px; font-size: 12px; color: #666; white-space: nowrap; overflow: hidden; z-index: 2; }
        .qr-area { position: absolute; bottom: 45px; right: 25px; width: 84px; height: 84px; background: #fff; padding: 3px; display: flex; align-items: center; justify-content: center; z-index: 2; }
        .qr-area img { width: 100%; height: auto; }
        .stamp { position: absolute; right: 120px; bottom: 60px; width: 88px; height: 88px; border: 3px solid rgba(220, 20, 20, 0.7); border-radius: 50%; color: rgba(220, 20, 20, 0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; transform: rotate(-15deg); z-index: 1; mix-blend-mode: multiply; background: radial-gradient(rgba(220,20,20,0.05), transparent); pointer-events: none; line-height: 1.1; }

        /* --- æ§åˆ¶é¢æ¿ --- */
        .controls {
            width: 100%;
            max-width: 640px;
            background: rgba(30, 40, 60, 0.85); 
            backdrop-filter: blur(12px);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            box-sizing: border-box;
        }
        
        .controls h3 {
            margin: 0 0 15px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
            font-size: 16px;
            color: #ffda77;
        }

        .control-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .control-item { display: flex; flex-direction: column; }
        .control-item.full { grid-column: span 2; }
        label { font-size: 12px; color: #aaa; margin-bottom: 4px; }
        input {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            padding: 8px;
            border-radius: 6px;
            font-size: 14px;
            width: 100%;
            box-sizing: border-box;
        }
        input:focus { outline: none; border-color: #ffda77; background: rgba(0,0,0,0.5); }
        .btn-download {
            grid-column: span 2;
            margin-top: 15px;
            padding: 14px;
            background: linear-gradient(135deg, #d80000, #900000);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            text-align: center;
        }
        .btn-download:active { opacity: 0.9; transform: scale(0.98); }
        .tips { font-size: 12px; color: #888; text-align: center; margin-top: 10px; }
    </style>
    <!-- Matomo -->
    <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        var u="//statistic.biss.click/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '2']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
    </script>
    <!-- End Matomo Code -->
</head>
<body>
    <h2>ğŸ® 2026æ–°æ˜¥ Â· å›¢åœ†å·</h2>

    <div id="scale-container">
        <div class="ticket" id="ticket-node">
            <svg class="watermark-lantern" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor">
                <path d="M416 128H352V96C352 78.33 337.7 64 320 64H192C174.3 64 160 78.33 160 96V128H96C60.65 128 32 156.7 32 192V320C32 355.3 60.65 384 96 384H160V432C160 449.7 174.3 464 192 464H320C337.7 464 352 449.7 352 432V384H416C451.3 384 480 355.3 480 320V192C480 156.7 451.3 128 416 128zM304 416H208V384H304V416zM432 320C432 328.8 424.8 336 416 336H96C87.16 336 80 328.8 80 320V192C80 183.2 87.16 176 96 176H416C424.8 176 432 183.2 432 192V320zM304 128H208V112H304V128z M256 192 C269.3 192 280 202.7 280 216 V296 C280 309.3 269.3 320 256 320 C242.7 320 232 309.3 232 296 V216 C232 202.7 242.7 192 256 192 Z"/>
            </svg>

            <div class="serial-number" id="disp-serial">No.2026-0217-CNY</div>
            <div class="check-gate"><span id="disp-gate">26</span>æ£€ç¥¨å£</div>

            <div class="station-row">
                <div class="station" id="disp-start">ä¹™å·³è›‡å¹´</div>
                <div class="train-center">
                    <span class="train-code" id="disp-train">G2026</span>
                    <div class="arrow-icon">â¸»&nbsp;â©¥</div>
                </div>
                <div class="station" id="disp-end">ä¸™åˆé©¬å¹´</div>
            </div>

            <div class="info-row">
                <div class="date-section">
                    <div id="disp-date">2026å¹´02æœˆ17æ—¥</div>
                    <div style="font-size: 14px; margin-top: 5px;" id="disp-time">08:00 å¼€</div>
                </div>
                <div class="price-section">
                    ï¿¥<span id="disp-price">æ— ä»·</span>
                </div>
            </div>

            <div class="seat-row">
                <span id="disp-car">01è½¦</span>
                <span id="disp-seat">01Aå·</span>
                <span class="seat-class-label" id="disp-seat-class">ç‰¹ç­‰åº§</span>
            </div>

            <div class="passenger-row">
                <span class="passenger-name" id="disp-name">è¿½æ¢¦äºº</span>
                <span class="passenger-id" id="disp-id">110***20260217****</span>
            </div>

            <div class="bottom-bar">
                <span id="disp-ad">è¾æ—§è¿æ–° Â· é˜–å®¶æ¬¢ä¹ | é™ä¹˜å½“æ—¥å½“æ¬¡è½¦</span>
            </div>

            <div class="qr-area" id="qrcode"></div>

            <div class="stamp">
                <div id="disp-stamp1">æ–°å¹´</div>
                <div id="disp-stamp2">å¿«ä¹</div>
            </div>
        </div>
    </div>

    <div class="controls">
        <h3>ğŸ“ è‡ªç”±ç¼–è¾‘æ‰€æœ‰ä¿¡æ¯</h3>
        <div class="control-grid">
            <div class="control-item">
                <label>å§‹å‘ç«™</label>
                <input type="text" id="in-start" value="ä¹™å·³è›‡å¹´">
            </div>
            <div class="control-item">
                <label>ç»ˆç‚¹ç«™</label>
                <input type="text" id="in-end" value="ä¸™åˆé©¬å¹´">
            </div>

            <div class="control-item">
                <label>ä¹˜è½¦æ—¥æœŸ</label>
                <input type="text" id="in-date" value="2026å¹´02æœˆ17æ—¥">
            </div>
            <div class="control-item">
                <label>å‘è½¦æ—¶é—´</label>
                <input type="text" id="in-time" value="08:00 å¼€">
            </div>

            <div class="control-item">
                <label>è½¦æ¬¡</label>
                <input type="text" id="in-train" value="G2026">
            </div>
            <div class="control-item">
                <label>ç¥¨ä»·</label>
                <input type="text" id="in-price" value="æ— ä»·">
            </div>

            <div class="control-item">
                <label>è½¦å¢å·</label>
                <input type="text" id="in-car" value="01è½¦">
            </div>
            <div class="control-item">
                <label>åº§ä½å·</label>
                <input type="text" id="in-seat" value="01Aå·">
            </div>

            <div class="control-item">
                <label>åº§ä½ç­‰çº§</label>
                <input type="text" id="in-seat-class" value="ç‰¹ç­‰åº§">
            </div>
            <div class="control-item">
                <label>æ£€ç¥¨å£</label>
                <input type="text" id="in-gate" value="26">
            </div>

            <div class="control-item">
                <label>å§“å (ç”ŸæˆäºŒç»´ç )</label>
                <input type="text" id="in-name" value="è¿½æ¢¦äºº">
            </div>
            <div class="control-item">
                <label>ç¥¨é¢å·¦ä¸Šåºåˆ—å·</label>
                <input type="text" id="in-serial" value="No.2026-0217-CNY">
            </div>

            <div class="control-item full">
                <label>èº«ä»½è¯å· (ä»…å±•ç¤º)</label>
                <input type="text" id="in-id" value="110***20260217****">
            </div>

            <div class="control-item full">
                <label>å°ç« æ–‡å­— (ç©ºæ ¼åˆ†éš”ä¸Šä¸‹è¡Œ)</label>
                <input type="text" id="in-stamp" value="æ–°å¹´ å¿«ä¹">
            </div>

            <div class="control-item full">
                <label>åº•éƒ¨å¹¿å‘Šè¯­</label>
                <input type="text" id="in-ad" value="è¾æ—§è¿æ–° Â· é˜–å®¶æ¬¢ä¹ | é™ä¹˜å½“æ—¥å½“æ¬¡è½¦">
            </div>

            <button class="btn-download" onclick="downloadTicket()">ğŸ“¸ ç”Ÿæˆå¹¶ä¿å­˜é«˜æ¸…å›¾ç‰‡</button>
        </div>
        <div class="tips">æç¤ºï¼šç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è‡ªåŠ¨ä¸‹è½½ï¼Œæˆ–é•¿æŒ‰è½¦ç¥¨ä¿å­˜</div>
    </div>

    <script>
        function fitTicket() {
            const container = document.getElementById('scale-container');
            const ticket = document.querySelector('.ticket');
            const ticketWidth = 640;
            const screenWidth = container.offsetWidth; 
            let scale = screenWidth / ticketWidth;
            if (scale > 1) scale = 1;
            ticket.style.transform = `scale(${scale})`;
            container.style.height = (400 * scale) + 'px';
        }
        window.addEventListener('resize', fitTicket);
        window.addEventListener('load', fitTicket);

        const qrcode = new QRCode(document.getElementById("qrcode"), {
            width: 80, height: 80, colorDark : "#000", colorLight : "#fff", correctLevel : QRCode.CorrectLevel.H
        });
        function updateQR(text) { qrcode.clear(); qrcode.makeCode(text + " æ–°å¹´å¤§å‰"); }
        updateQR("è¿½æ¢¦äºº");

        const mappings = {
            'in-start': 'disp-start', 'in-end': 'disp-end', 
            'in-date': 'disp-date', 'in-time': 'disp-time',
            'in-train': 'disp-train', 'in-price': 'disp-price',
            'in-car': 'disp-car', 'in-seat': 'disp-seat', 'in-seat-class': 'disp-seat-class',
            'in-gate': 'disp-gate', 'in-name': 'disp-name', 
            'in-id': 'disp-id', 'in-serial': 'disp-serial', 'in-ad': 'disp-ad'
        };

        for (let [inputId, dispId] of Object.entries(mappings)) {
            const input = document.getElementById(inputId);
            const disp = document.getElementById(dispId);
            if(input && disp) {
                input.addEventListener('input', (e) => {
                    disp.innerText = e.target.value;
                    if(inputId === 'in-name') updateQR(e.target.value);
                });
            }
        }
        
        document.getElementById('in-stamp').addEventListener('input', (e) => {
            const parts = e.target.value.split(' ');
            document.getElementById('disp-stamp1').innerText = parts[0] || '';
            document.getElementById('disp-stamp2').innerText = parts[1] || '';
        });

        function downloadTicket() {
            const node = document.getElementById('ticket-node');
            const originalTransform = node.style.transform;
            node.style.transform = 'none';
            html2canvas(node, { scale: 2, backgroundColor: null, useCORS: true }).then(canvas => {
                node.style.transform = originalTransform;
                try {
                    const link = document.createElement('a');
                    link.download = '2026æ–°æ˜¥è½¦ç¥¨.png';
                    link.href = canvas.toDataURL("image/png");
                    document.body.appendChild(link); link.click(); document.body.removeChild(link);
                } catch (e) { alert("è¯·é•¿æŒ‰å›¾ç‰‡æ‰‹åŠ¨ä¿å­˜"); }
            }).catch(err => { 
                node.style.transform = originalTransform; 
                alert("ç”Ÿæˆå¤±è´¥ï¼Œè¯·æˆªå›¾ä¿å­˜"); 
            });
        }
    </script>
</body>
</html>