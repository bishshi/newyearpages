<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>2026 é©¬å¹´å¥½è¿æŠ½å¥–</title>
    <link rel="stylesheet" href="lottery.css">
</head>
<body>

    <div id="fireworks"></div>

    <div class="lottery-wrapper">
        <div class="main-card">
            <div style="font-size: 50px;">ğŸ</div>
            <h1 class="title-gold">é©¬å¹´å¥½è¿æŠ½å¥–</h1>
            <p id="welcomeMsg" style="color: #fff; margin-bottom: 30px;">ç­–é©¬æ‰¬é­å¼€å¯ä¸€å¹´å¥½è¿</p>
            
            <button class="draw-btn" id="drawBtn" onclick="handleDraw()">å³åˆ»æŠ½å¥–</button>
            
            <div style="margin-top: 30px;">
                <a id="backToCard" href="#" style="color: var(--accent-gold); text-decoration: none; font-size: 0.9rem; opacity: 0.7;">â† è¿”å›è´ºå¡</a>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-content">
            <h3 style="color: #fff; margin: 0;">ğŸŠ æ­å–œä¸­å¥– ğŸŠ</h3>
            <div id="prizeContainer">
                <span class="prize-title" id="friendNameDisplay">äº²çˆ±çš„æœ‹å‹ï¼š</span>
                <span class="prize-text" id="prizeResult">æ­£åœ¨æŠ½å–...</span>
            </div>
            <p style="color: rgba(255,255,255,0.8); font-size: 0.85rem; line-height: 1.6;">
                ç¥æ‚¨åœ¨2026ä¸™åˆé©¬å¹´<br>é¾™é©¬ç²¾ç¥ï¼Œä¸‡äº‹èƒœæ„ï¼
            </p>
            <button class="close-btn" onclick="closeModal()">æ”¶ä¸‹å¥½è¿</button>
        </div>
    </div>

    <audio id="bgMusic" loop>
        <source src="https://music.163.com/song/media/outer/url?id=1416563364.mp3" type="audio/mpeg">
    </audio>
    <div id="musicBtn" onclick="toggleMusic()"><span id="musicIcon">ğŸµ</span></div>

    <script>
        // --- å‚æ•°è§£æä¸åˆå§‹åŒ– ---
        let currentFriendName = "å¥½æœ‹å‹";
        
        function initParams() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            const name = params.get('name');

            if (id) {
                document.getElementById('backToCard').href = `https://newyearpages.biss.click/2026-${id}.html`;
            } else {
                document.getElementById('backToCard').style.display = 'none';
            }

            if (name) {
                currentFriendName = decodeURIComponent(name);
                document.getElementById('welcomeMsg').innerText = `ç¥ ${currentFriendName} é©¬å¹´å¤§å‰ï¼`;
                document.getElementById('friendNameDisplay').innerText = `${currentFriendName} çš„æ–°å¹´ç¤¼æ˜¯ï¼š`;
            }
        }

        // --- æŠ½å¥–é€»è¾‘ ---
        const prizes = [
            { name: "ğŸ ä¸€ç”Ÿå¹³å®‰å–œä¹", weight: 40 },
            { name: "ğŸ§§ é”¦é²¤å¤§çº¢åŒ…", weight: 10 },
            { name: "ğŸ é©¬åˆ°æˆåŠŸç¬¦", weight: 25 },
            { name: "ğŸ’° è´¢æºæ»šæ»šæ¥", weight: 20 },
            { name: "â­ ç¥ç§˜ç»ˆæå¤§å¥–", weight: 5 }
        ];

        function handleDraw() {
            const btn = document.getElementById('drawBtn');
            btn.disabled = true;
            btn.innerText = "å¥½è¿æŠ½å–ä¸­...";

            setTimeout(() => {
                const total = prizes.reduce((s, p) => s + p.weight, 0);
                let random = Math.random() * total;
                let selected = prizes[0].name;
                
                for (const p of prizes) {
                    if (random < p.weight) {
                        selected = p.name;
                        break;
                    }
                    random -= p.weight;
                }

                document.getElementById('prizeResult').innerText = selected;
                document.getElementById('modalOverlay').classList.add('active');
                btn.disabled = false;
                btn.innerText = "å†æ¬¡æŠ½å¥–";
            }, 1000);
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        // --- çƒŸèŠ± & éŸ³ä¹ ---
        function createFirework() {
            const container = document.getElementById('fireworks');
            const x = Math.random() * window.innerWidth;
            const color = ['#FFD700', '#FF4500', '#FFFFFF'][Math.floor(Math.random()*3)];
            for (let i = 0; i < 15; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = x + 'px';
                p.style.backgroundColor = color;
                p.style.setProperty('--tx', (Math.random() * 240 - 120) + 'px');
                p.style.setProperty('--ty', (Math.random() * -300 - 50) + 'px');
                container.appendChild(p);
                setTimeout(() => p.remove(), 2000);
            }
        }
        setInterval(createFirework, 800);

        const audio = document.getElementById('bgMusic');
        function toggleMusic() {
            if (audio.paused) { 
                audio.play(); 
                document.getElementById('musicIcon').style.animation = 'rotating 2s linear infinite'; 
            } else { 
                audio.pause(); 
                document.getElementById('musicIcon').style.animation = 'none'; 
            }
        }
        document.addEventListener('click', () => { if(audio.paused) toggleMusic(); }, {once: true});

        // å¯åŠ¨åˆå§‹åŒ–
        initParams();
    </script>
</body>
</html>