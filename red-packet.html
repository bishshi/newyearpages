<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é©¬åˆ°æˆåŠŸ - 2026é©¬å¹´è´ºå²</title>
    <style>
        :root {
            --gold: #ffd700;
            --red: #ff3b5c;
            --dark-red: #8b0000;
            --shadow-gold: rgba(255, 215, 0, 0.3);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: linear-gradient(135deg, #1a0000 0%, #4a0000 50%, #1a0000 100%);
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
            touch-action: none;
        }

        /* èƒŒæ™¯åŠ¨ç”» */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 59, 92, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 215, 0, 0.05) 0%, transparent 50%);
            animation: bgPulse 8s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes bgPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* é¡¶éƒ¨ä¿¡æ¯æ  */
        .info-bar {
            position: fixed;
            top: 15px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            padding: 0 20px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .info-item .icon {
            font-size: 20px;
        }

        .info-item .value {
            color: var(--gold);
            font-size: clamp(18px, 5vw, 22px);
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        /* æ¸¸æˆå®¹å™¨ */
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* ä¼ ç»Ÿçº¢åŒ…æ ·å¼ */
        .red-packet {
            position: absolute;
            width: 80px;
            height: 110px;
            cursor: pointer;
            user-select: none;
            pointer-events: auto;
        }

        /* çº¢åŒ…ä¸»ä½“ */
        .packet-card {
            width: 100%;
            height: 100%;
            position: relative;
            background: linear-gradient(180deg, #ff0000 0%, #cc0000 100%);
            border-radius: 10px;
            box-shadow: 
                0 8px 20px rgba(0, 0, 0, 0.5),
                inset 0 2px 5px rgba(255, 255, 255, 0.3),
                inset 0 -2px 5px rgba(0, 0, 0, 0.3);
            border: 2px solid #d4af37;
        }

        /* çº¢åŒ…é¡¶éƒ¨å°å£ */
        .packet-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 28px;
            background: linear-gradient(180deg, #d4af37 0%, #c5a028 100%);
            border-radius: 8px 8px 0 0;
            border-bottom: 2px solid #b8941f;
            box-shadow: inset 0 1px 3px rgba(255, 255, 255, 0.5);
        }

        /* çº¢åŒ…é¡¶éƒ¨è£…é¥°åœ†ç‚¹ */
        .packet-card::after {
            content: "";
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 8px;
            background: #8b7355;
            border-radius: 50%;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* çº¢åŒ…ä¸­é—´çš„ç¦å­— */
        .packet-icon {
            position: absolute;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, #ffe680 0%, #d4af37 70%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            color: #cc0000;
            border: 3px solid #b8941f;
            box-shadow: 
                0 3px 10px rgba(0, 0, 0, 0.4),
                inset 0 2px 5px rgba(255, 255, 255, 0.5),
                inset 0 -2px 5px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }

        /* çº¢åŒ…èŠ±çº¹è£…é¥° */
        .packet-pattern {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: repeating-linear-gradient(
                90deg,
                #d4af37 0px,
                #d4af37 5px,
                transparent 5px,
                transparent 10px
            );
            opacity: 0.8;
        }

        /* çº¢åŒ…ç‚¹å‡»åŠ¨ç”» */
        .red-packet.grabbed .packet-card {
            animation: grabPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes grabPop {
            0% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
            50% { 
                transform: scale(1.3) rotate(10deg);
                opacity: 0.9;
            }
            100% { 
                transform: scale(0) rotate(25deg);
                opacity: 0;
            }
        }

        /* ç»“ç®—å¼¹çª— */
        #result-mask {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .result-card {
            background: linear-gradient(135deg, #2a0000 0%, #1a0000 100%);
            padding: 50px 40px;
            border-radius: 30px;
            border: 3px solid var(--gold);
            text-align: center;
            color: var(--gold);
            max-width: 350px;
            width: 90%;
            box-shadow: 
                0 0 60px rgba(255, 215, 0, 0.4),
                inset 0 2px 20px rgba(255, 215, 0, 0.1);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0.5) translateY(50px); opacity: 0; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }

        .result-card h2 {
            font-size: clamp(30px, 8vw, 38px);
            margin: 0 0 10px 0;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.5));
        }

        .result-card .score-num {
            font-size: clamp(56px, 15vw, 72px);
            color: #fff;
            display: block;
            margin: 20px 0;
            font-weight: bold;
            text-shadow: 
                0 0 20px var(--gold),
                0 0 40px var(--gold);
        }

        .result-card .wish {
            font-size: clamp(16px, 4vw, 18px);
            line-height: 1.8;
            color: #ffcccb;
            margin-bottom: 30px;
        }

        .btn-restart {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1a0000;
            border: none;
            padding: 15px 50px;
            font-size: clamp(18px, 5vw, 22px);
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #b38600, 0 8px 20px rgba(255, 215, 0, 0.4);
            transition: all 0.2s;
        }

        .btn-restart:active {
            transform: translateY(3px);
            box-shadow: 0 3px 0 #b38600, 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        /* ç‚¹å‡»åé¦ˆ */
        .plus-one {
            position: fixed;
            color: var(--gold);
            font-weight: bold;
            font-size: 32px;
            animation: floatUp 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            pointer-events: none;
            z-index: 500;
            text-shadow: 
                0 0 10px rgba(255, 215, 0, 0.8),
                0 0 20px var(--gold);
        }

        @keyframes floatUp {
            0% { 
                opacity: 1;
                transform: translateY(0) scale(0.8);
            }
            100% { 
                opacity: 0;
                transform: translateY(-100px) scale(1.5);
            }
        }

        /* å¼€å§‹ç•Œé¢ */
        .start-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a0000 0%, #4a0000 50%, #1a0000 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            gap: 40px;
        }

        .start-title {
            font-size: clamp(40px, 12vw, 56px);
            background: linear-gradient(135deg, #ffd700, #ffed4e, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.6));
            animation: titlePulse 2s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .difficulty-selector {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            padding: 0 20px;
        }

        .difficulty-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 2px solid rgba(255, 215, 0, 0.3);
            padding: 15px 30px;
            font-size: clamp(16px, 4vw, 18px);
            font-weight: bold;
            border-radius: 15px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
            min-width: 120px;
        }

        .difficulty-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: var(--gold);
            transform: translateY(-2px);
        }

        .difficulty-btn.selected {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1a0000;
            border-color: var(--gold);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .difficulty-label {
            color: var(--gold);
            font-size: clamp(18px, 5vw, 22px);
            margin-bottom: 15px;
            font-weight: bold;
        }

        .btn-start {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #1a0000;
            border: none;
            padding: 20px 60px;
            font-size: clamp(22px, 6vw, 28px);
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 0 #b38600, 0 10px 30px rgba(255, 215, 0, 0.4);
            transition: all 0.2s;
            margin-top: 20px;
        }

        .btn-start:active {
            transform: translateY(4px);
            box-shadow: 0 4px 0 #b38600, 0 6px 20px rgba(255, 215, 0, 0.4);
        }
    </style>
</head>
<body>

    <!-- å¼€å§‹ç•Œé¢ -->
    <div class="start-overlay" id="start-overlay">
        <div class="start-title">ğŸ´ é©¬åˆ°æˆåŠŸ ğŸ´</div>
        
        <div>
            <div class="difficulty-label">é€‰æ‹©éš¾åº¦</div>
            <div class="difficulty-selector">
                <button class="difficulty-btn" data-speed="easy">
                    ğŸŒ ç®€å•
                </button>
                <button class="difficulty-btn selected" data-speed="normal">
                    ğŸ æ™®é€š
                </button>
                <button class="difficulty-btn" data-speed="hard">
                    ğŸš€ å›°éš¾
                </button>
            </div>
        </div>
        
        <button class="btn-start" id="btn-start">å¼€å§‹æ¸¸æˆ</button>
    </div>

    <div class="info-bar">
        <div class="info-item">
            <span class="icon">â±ï¸</span>
            <span class="value" id="timer">30</span>
        </div>
        <div class="info-item">
            <span class="icon">ğŸ’°</span>
            <span class="value" id="score">0</span>
        </div>
    </div>

    <!-- æ¸¸æˆå®¹å™¨ -->
    <div id="game-container"></div>

    <div id="result-mask">
        <div class="result-card">
            <h2 id="result-title">é©¬åˆ°æˆåŠŸï¼</h2>
            <p style="color: #ffcccb; margin: 10px 0;">æ­å–œæŠ¢åˆ°</p>
            <span class="score-num" id="final-score">0</span>
            <span style="color: var(--gold); font-size: 20px; display: block; margin-bottom: 20px;">é‡‘å¸</span>
            <p class="wish" id="result-wish"></p>
            <button class="btn-restart" onclick="location.reload()">å†æ¥ä¸€å±€</button>
        </div>
    </div>

    <script>
        // éš¾åº¦é…ç½®
        const DIFFICULTY_CONFIG = {
            easy: {
                speedMin: 0.8,
                speedMax: 1.5,
                spawnInterval: 500
            },
            normal: {
                speedMin: 1.2,
                speedMax: 2.5,
                spawnInterval: 400
            },
            hard: {
                speedMin: 2.5,
                speedMax: 4.5,
                spawnInterval: 300
            }
        };

        // æ¸¸æˆé…ç½®
        let CONFIG = {
            GAME_DURATION: 30,
            SPAWN_INTERVAL: 400,
            FALL_SPEED_MIN: 1.2,
            FALL_SPEED_MAX: 2.5,
            SCORE_THRESHOLDS: {
                EXCELLENT: 35,
                GOOD: 15
            }
        };

        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            score: 0,
            timeLeft: CONFIG.GAME_DURATION,
            isActive: false,
            packets: [],
            difficulty: 'normal'
        };

        // DOM å…ƒç´ ç¼“å­˜
        const elements = {
            score: document.getElementById('score'),
            timer: document.getElementById('timer'),
            resultMask: document.getElementById('result-mask'),
            finalScore: document.getElementById('final-score'),
            resultTitle: document.getElementById('result-title'),
            resultWish: document.getElementById('result-wish'),
            startOverlay: document.getElementById('start-overlay'),
            btnStart: document.getElementById('btn-start'),
            gameContainer: document.getElementById('game-container')
        };

        let countdownInterval = null;
        let spawnInterval = null;

        // éš¾åº¦é€‰æ‹©
        const difficultyBtns = document.querySelectorAll('.difficulty-btn');
        difficultyBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                difficultyBtns.forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                gameState.difficulty = btn.dataset.speed;
            });
        });

        // å¼€å§‹æ¸¸æˆ
        elements.btnStart.addEventListener('click', startGame);

        function startGame() {
            // åº”ç”¨éš¾åº¦è®¾ç½®
            const difficulty = DIFFICULTY_CONFIG[gameState.difficulty];
            CONFIG.FALL_SPEED_MIN = difficulty.speedMin;
            CONFIG.FALL_SPEED_MAX = difficulty.speedMax;
            CONFIG.SPAWN_INTERVAL = difficulty.spawnInterval;
            
            // æ ¹æ®éš¾åº¦è°ƒæ•´åˆ†æ•°é˜ˆå€¼
            if (gameState.difficulty === 'easy') {
                CONFIG.SCORE_THRESHOLDS.EXCELLENT = 25;
                CONFIG.SCORE_THRESHOLDS.GOOD = 12;
            } else if (gameState.difficulty === 'hard') {
                CONFIG.SCORE_THRESHOLDS.EXCELLENT = 50;
                CONFIG.SCORE_THRESHOLDS.GOOD = 25;
            }
            
            elements.startOverlay.style.display = 'none';
            gameState.isActive = true;
            startCountdown();
            startSpawning();
        }

        // å€’è®¡æ—¶
        function startCountdown() {
            countdownInterval = setInterval(() => {
                if (!gameState.isActive) return;
                
                gameState.timeLeft--;
                elements.timer.textContent = gameState.timeLeft;
                
                if (gameState.timeLeft <= 5) {
                    elements.timer.parentElement.style.borderColor = '#ff6b6b';
                    elements.timer.style.color = '#ff6b6b';
                }
                
                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        // å¼€å§‹ç”Ÿæˆçº¢åŒ…
        function startSpawning() {
            spawnInterval = setInterval(createRedPacket, CONFIG.SPAWN_INTERVAL);
        }

        // åˆ›å»ºçº¢åŒ…
        function createRedPacket() {
            if (!gameState.isActive) return;

            const packet = document.createElement('div');
            packet.className = 'red-packet';
            
            packet.innerHTML = `
                <div class="packet-card">
                    <div class="packet-icon">ç¦</div>
                    <div class="packet-pattern"></div>
                </div>
            `;
            
            // çº¢åŒ…æ•°æ®å¯¹è±¡
            const packetData = {
                element: packet,
                x: Math.random() * (window.innerWidth - 85),
                y: -120,
                speed: Math.random() * (CONFIG.FALL_SPEED_MAX - CONFIG.FALL_SPEED_MIN) + CONFIG.FALL_SPEED_MIN,
                rotation: Math.random() * 20 - 10,  // å°è§’åº¦æ—‹è½¬æ›´è‡ªç„¶
                grabbed: false,
                animationId: null
            };
            
            // è®¾ç½®åˆå§‹æ ·å¼
            packet.style.left = packetData.x + 'px';
            packet.style.top = packetData.y + 'px';
            
            // ç‚¹å‡»å¤„ç†
            const handleClick = (e) => {
                if (!gameState.isActive || packetData.grabbed) return;
                
                e.preventDefault();
                e.stopPropagation();
                
                packetData.grabbed = true;
                
                const clientX = e.clientX ?? e.touches?.[0]?.clientX ?? 0;
                const clientY = e.clientY ?? e.touches?.[0]?.clientY ?? 0;
                
                gameState.score++;
                elements.score.textContent = gameState.score;
                
                showFeedback(clientX, clientY);
                
                // åœæ­¢åŠ¨ç”»
                if (packetData.animationId) {
                    cancelAnimationFrame(packetData.animationId);
                }
                
                // æ·»åŠ æŠ“å–åŠ¨ç”»
                packet.classList.add('grabbed');
                
                // å»¶è¿Ÿç§»é™¤
                setTimeout(() => {
                    removePacket(packetData);
                }, 400);
            };
            
            packet.addEventListener('mousedown', handleClick);
            packet.addEventListener('touchstart', handleClick, { passive: false });
            
            // æ·»åŠ åˆ°å®¹å™¨
            elements.gameContainer.appendChild(packet);
            gameState.packets.push(packetData);
            
            // å¼€å§‹ä¸‹è½åŠ¨ç”»
            animate(packetData);
        }

        // åŠ¨ç”»å‡½æ•°
        function animate(packetData) {
            if (!gameState.isActive || packetData.grabbed) return;
            
            // æ›´æ–°ä½ç½®
            packetData.y += packetData.speed;
            packetData.rotation += 0.3;  // è½»å¾®æ—‹è½¬
            
            packetData.element.style.top = packetData.y + 'px';
            packetData.element.querySelector('.packet-card').style.transform = 
                `rotate(${packetData.rotation}deg)`;
            
            // å¦‚æœè¿˜åœ¨å±å¹•å†…ï¼Œç»§ç»­åŠ¨ç”»
            if (packetData.y < window.innerHeight + 50) {
                packetData.animationId = requestAnimationFrame(() => animate(packetData));
            } else {
                // æ‰å‡ºå±å¹•ï¼Œç§»é™¤
                removePacket(packetData);
            }
        }

        // ç§»é™¤çº¢åŒ…
        function removePacket(packetData) {
            if (packetData.animationId) {
                cancelAnimationFrame(packetData.animationId);
            }
            
            const index = gameState.packets.indexOf(packetData);
            if (index > -1) {
                gameState.packets.splice(index, 1);
            }
            
            if (packetData.element && packetData.element.parentNode) {
                packetData.element.parentNode.removeChild(packetData.element);
            }
        }

        // æ˜¾ç¤º +1 åé¦ˆ
        function showFeedback(x, y) {
            const feedback = document.createElement('div');
            feedback.className = 'plus-one';
            feedback.textContent = '+1';
            feedback.style.left = x - 20 + 'px';
            feedback.style.top = y - 30 + 'px';
            
            document.body.appendChild(feedback);
            setTimeout(() => feedback.remove(), 1000);
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            gameState.isActive = false;
            clearInterval(countdownInterval);
            clearInterval(spawnInterval);
            
            // æ¸…é™¤æ‰€æœ‰å‰©ä½™çº¢åŒ…
            gameState.packets.forEach(packetData => {
                if (packetData.animationId) {
                    cancelAnimationFrame(packetData.animationId);
                }
                if (packetData.element) {
                    packetData.element.style.transition = 'opacity 0.5s';
                    packetData.element.style.opacity = '0';
                    setTimeout(() => {
                        if (packetData.element && packetData.element.parentNode) {
                            packetData.element.parentNode.removeChild(packetData.element);
                        }
                    }, 500);
                }
            });
            
            gameState.packets = [];
            
            // æ˜¾ç¤ºç»“æœ
            setTimeout(showResult, 500);
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult() {
            const { score } = gameState;
            let title, wish;

            if (score > CONFIG.SCORE_THRESHOLDS.EXCELLENT) {
                title = "ä¸€é©¬å½“å…ˆï¼";
                wish = "æ‰‹é€Ÿå°ç¥ï¼2026é©¬å¹´æ‚¨å¿…å°†å¤§å±•å®å›¾ï¼Œç¦æ˜Ÿé«˜ç…§ï¼Œä¸‡äº‹å¦‚æ„ï¼";
            } else if (score > CONFIG.SCORE_THRESHOLDS.GOOD) {
                title = "é¾™é©¬ç²¾ç¥ï¼";
                wish = "å¥½è¿ä¸´é—¨ï¼ç¥æ‚¨æ–°çš„ä¸€å¹´èº«ä½“æ£’ã€èƒƒå£å¥½ï¼Œæ¯å¤©éƒ½ç¥é‡‡å¥•å¥•ï¼";
            } else {
                title = "é©¬åˆ°æˆåŠŸï¼";
                wish = "å¼€é—¨å¤§å‰ï¼ç¥æ‚¨åœ¨2026é©¬å¹´æ­¥æ­¥é«˜å‡ï¼Œå¿ƒæƒ³äº‹æˆï¼";
            }

            elements.finalScore.textContent = score;
            elements.resultTitle.textContent = title;
            elements.resultWish.textContent = wish;
            elements.resultMask.style.display = 'flex';
        }

        // ç¦æ­¢é¡µé¢æ»šåŠ¨å’Œç¼©æ”¾
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });

        document.addEventListener('gesturestart', (e) => {
            e.preventDefault();
        });
        
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (e) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>